<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ê†°Âõ≠APP</title>
    <!-- ÂºïÂÖ•Vue.jsÂíåAxios -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- ÂºïÂÖ•Element UI -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <!-- ÂºïÂÖ•Ëá™ÂÆö‰πâÊ†∑Âºè -->
    <link rel="stylesheet" href="/static/accounts/css/styles.css">
    

    <style>
        /* Ê∑ªÂä†v-cloakÊåá‰ª§ÁöÑCSSÔºåÈò≤Ê≠¢Èó™Áé∞Êú™ÁºñËØëÁöÑÊ®°Êùø */
        [v-cloak] {
            display: none;
        }
        
        /* APPÂ∏ÉÂ±ÄÊ†∑Âºè */
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            overflow-x: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            max-width: 100%;
            margin: 0 auto;
            position: relative;
        }
        
        /* È°∂ÈÉ®ÂØºËà™Ê†è */
        .top-bar {
            background-color: #409EFF;
            color: white;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            height: 50px;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        
        .top-bar .title {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            flex: 1;
        }
        
        .top-bar .action-btn {
            font-size: 20px;
            cursor: pointer;
            min-width: 40px;
            display: flex;
            justify-content: flex-end;
        }
        
        /* ÂÜÖÂÆπÂå∫Âüü */
        .content-area {
            flex: 1;
            margin-top: 74px;
            margin-bottom: 60px;
            padding: 15px;
            overflow-y: auto;
            z-index: 10; /* Á°Æ‰øùÂÜÖÂÆπÂå∫ÂüüÂú®ÂØºËà™Ê†è‰πã‰∏ã */
            position: relative;
            transition: opacity 0.3s ease;
        }
        
        /* Â∫ïÈÉ®ÂØºËà™ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: white;
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .nav-item {
            text-align: center;
            padding: 5px 0;
            width: 33.33%;
            cursor: pointer;
            color: #666;
            font-size: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .nav-item.active {
            color: #409EFF;
        }
        
        .nav-icon {
            font-size: 22px;
            margin-bottom: 3px;
        }
        
        /* Â≠¶Ê†°ÈÄâÊã©Âô® */
        .school-selector {
            background-color: white;
            padding: 12px 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        /* Âç°ÁâáÊ†∑Âºè */
        .card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .card-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 12px;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* ËÆ∫ÂùõÂ∏ñÂ≠ê */
        .post-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0;
            border-radius: 4px;
        }
        
        .post-item:hover {
            background-color: #ecf5ff;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .post-item:last-child {
            border-bottom: none;
        }
        
        .post-title {
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #303133;
        }
        
        .title-text {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .post-item:hover .title-text {
            color: #409EFF;
        }
        
        .post-title i {
            opacity: 0;
            transition: all 0.3s ease;
            margin-left: 5px;
        }
        
        .post-item:hover .post-title i {
            opacity: 1;
            transform: translateX(3px);
            color: #409EFF;
        }
        
        .post-meta {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #909399;
        }
        
        /* ÊâìÂç°È°πÁõÆ */
        .checkin-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        
        .checkin-item:last-child {
            border-bottom: none;
        }
        
        .checkin-info {
            flex: 1;
        }
        
        .checkin-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .checkin-time {
            font-size: 12px;
            color: #999;
        }
        
        /* ‰∏™‰∫∫‰∏≠ÂøÉËèúÂçï */
        .profile-menu {
            display: flex;
            flex-direction: column;
        }
        
        .menu-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #eee;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0;
            border-radius: 4px;
        }
        
        .menu-item:hover {
            background-color: #ecf5ff;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .menu-item:last-child {
            border-bottom: none;
        }

        .menu-item i.el-icon-arrow-right {
            opacity: 0;
            transition: all 0.3s ease;
            margin-left: 5px;
        }
        
        .menu-item:hover i.el-icon-arrow-right {
            opacity: 1;
            transform: translateX(3px);
            color: #409EFF;
        }
        
        body.dark-mode .menu-item:hover {
            background-color: #2a2a2a;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }
        
        body.dark-mode .menu-item:hover i.el-icon-arrow-right {
            color: #87CEFA;
        }
        
        .menu-item-left {
            display: flex;
            align-items: center;
            transition: color 0.3s ease;
        }
        
        .menu-item:hover .menu-item-left {
            color: #409EFF;
        }
        
        body.dark-mode .menu-item:hover .menu-item-left {
            color: #87CEFA;
        }
        
        .menu-icon {
            margin-right: 10px;
            color: #409EFF;
            font-size: 18px;
            transition: transform 0.3s ease, color 0.3s ease;
        }
        
        .menu-item:hover .menu-icon {
            transform: scale(1.2);
        }
        
        body.dark-mode .menu-icon {
            color: #87CEFA;
        }
        
        .avatar-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
        }
        
        .avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background-color: #409EFF;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .user-name {
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .user-info {
            font-size: 12px;
            color: #999;
        }
        
        /* Ë∞ÉËØïÂå∫ÂüüÊ†∑Âºè */
        #debug {
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin: 10px;
            font-family: monospace;
            font-size: 12px;
            position: fixed;
            bottom: 70px;
            left: 0;
            right: 0;
            max-height: 200px;
            overflow-y: auto;
            z-index: 2000;
            display: none; /* ÈªòËÆ§ÈöêËóèË∞ÉËØï‰ø°ÊÅØ */
        }
        #debug-log {
            max-height: 180px;
            overflow-y: auto;
        }
        #debug-log p {
            margin: 2px 0;
            padding: 2px 0;
            border-bottom: 1px solid #eee;
        }
        .task-section {
            margin-top: 20px;
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
        }
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .task-item {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
        }
        .task-title {
            font-weight: bold;
        }
        .task-info {
            color: #666;
            font-size: 0.9em;
            margin: 5px 0;
        }
        .task-actions {
            margin-top: 8px;
        }
        /* ÊâìÂç°Á§æÂå∫Ê†∑Âºè */
        .community-item {
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        
        .community-item:last-child {
            border-bottom: none;
        }
        
        .community-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .community-user {
            font-weight: bold;
            color: #409EFF;
        }
        
        .community-time {
            font-size: 12px;
            color: #999;
        }
        
        .community-content {
            font-size: 14px;
            line-height: 1.5;
        }
        
        .community-task {
            font-weight: bold;
            color: #67C23A;
        }
        
        /* ‰ªªÂä°È°πÁõÆÊ†∑Âºè */
        .task-title {
            font-weight: bold;
        }
        
        .task-info {
            color: #666;
            font-size: 0.9em;
            margin: 5px 0;
        }
        
        .task-actions {
            margin-top: 8px;
        }
        
        /* Â§úÈó¥Ê®°ÂºèÊ†∑Âºè */
        body {
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .card, .top-bar, .post-header, .post-content, .school-selector, .bottom-nav, 
        .el-dialog, .el-dropdown-menu, .el-button--default, .el-input__inner, .el-textarea__inner {
            transition: background-color 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
        
        .card-title, .post-title, .user-name, .post-meta, .user-info, .checkin-time, .menu-item, 
        .checkin-item, .community-item, .task-item, .el-dropdown-menu__item, .el-dialog__title, .el-dialog__close {
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        
        body.dark-mode {
            background-color: #121212;
            color: #e0e0e0;
        }
        
        body.dark-mode .top-bar {
            background-color: #1f1f1f;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        body.dark-mode .card,
        body.dark-mode .post-header,
        body.dark-mode .post-content,
        body.dark-mode .school-selector,
        body.dark-mode .bottom-nav {
            background-color: #1f1f1f;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        
        body.dark-mode .card-title,
        body.dark-mode .post-title,
        body.dark-mode .user-name {
            color: #e0e0e0;
        }
        
        body.dark-mode .post-meta,
        body.dark-mode .user-info,
        body.dark-mode .checkin-time {
            color: #aaaaaa;
        }
        
        body.dark-mode .post-item {
            border-bottom: 1px solid #333;
        }
        
        body.dark-mode .post-item:hover {
            background-color: #2a2a2a;
        }
        
        body.dark-mode .menu-item,
        body.dark-mode .checkin-item,
        body.dark-mode .community-item,
        body.dark-mode .task-item {
            border-bottom: 1px solid #333;
        }
        
        body.dark-mode .el-dropdown-menu {
            background-color: #1f1f1f;
            border-color: #333;
        }
        
        body.dark-mode .el-dropdown-menu__item {
            color: #e0e0e0;
        }
        
        body.dark-mode .el-dropdown-menu__item:hover {
            background-color: #2a2a2a;
            color: #409EFF;
        }
        
        body.dark-mode .el-dialog {
            background-color: #1f1f1f;
            border-color: #333;
        }
        
        body.dark-mode .el-dialog__title {
            color: #e0e0e0;
        }
        
        body.dark-mode .el-input__inner {
            background-color: #2a2a2a;
            border-color: #333;
            color: #e0e0e0;
        }
        
        body.dark-mode .el-textarea__inner {
            background-color: #2a2a2a;
            border-color: #333;
            color: #e0e0e0;
        }
        
        body.dark-mode .el-button--default {
            background-color: #2a2a2a;
            border-color: #333;
            color: #e0e0e0;
        }
        
        body.dark-mode .el-dialog__headerbtn .el-dialog__close {
            color: #e0e0e0;
        }
        
        /* ÂÜÖÂÆπËøáÊ∏°ÊïàÊûú */
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s;
        }
        .fade-enter, .fade-leave-to {
            opacity: 0;
        }
        
        /* Âä†ËΩΩÈÅÆÁΩ©Â±Ç */
        .loading-overlay {
            position: fixed;
            top: 74px;
            bottom: 60px;
            left: 0;
            right: 0;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            transition: opacity 0.3s ease;
        }
        
        body.dark-mode .loading-overlay {
            background-color: rgba(31, 31, 31, 0.8);
        }
        
        body.dark-mode .loading-overlay p {
            color: #e0e0e0;
                    }
            
            /* ‰∏ìÊ≥®Ê®°ÂºèÊ†∑Âºè */
            .focus-stats {
                display: flex;
                justify-content: space-around;
                padding: 20px 0;
                margin-bottom: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-radius: 12px;
                color: white;
            }
            
            .stat-item {
                text-align: center;
            }
            
            .stat-number {
                font-size: 24px;
                font-weight: bold;
                margin-bottom: 4px;
            }
            
            .stat-label {
                font-size: 12px;
                opacity: 0.8;
            }
            
            .focus-session-container {
                padding: 40px 20px;
                text-align: center;
                background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                border-radius: 20px;
                color: white;
                min-height: 60vh;
                display: flex;
                flex-direction: column;
                justify-content: center;
            }
            
            .focus-header h2 {
                font-size: 28px;
                margin-bottom: 10px;
                color: white;
            }
            
            .focus-header p {
                font-size: 16px;
                opacity: 0.9;
                margin-bottom: 40px;
            }
            
            .focus-timer {
                margin: 40px 0;
            }
            
            .timer-circle {
                width: 200px;
                height: 200px;
                border: 8px solid rgba(255, 255, 255, 0.3);
                border-radius: 50%;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                margin: 0 auto;
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            }
            
            .timer-display {
                font-size: 48px;
                font-weight: bold;
                font-family: 'Courier New', monospace;
                margin-bottom: 8px;
            }
            
            .timer-type {
                font-size: 14px;
                opacity: 0.8;
            }
            
            .focus-controls {
                display: flex;
                gap: 15px;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .focus-controls .el-button {
                border: 2px solid rgba(255, 255, 255, 0.3);
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                color: white;
                font-weight: bold;
                min-width: 100px;
            }
            
            .focus-controls .el-button:hover {
                background: rgba(255, 255, 255, 0.2);
                border-color: rgba(255, 255, 255, 0.5);
            }
            
            .focus-history-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 12px 0;
                border-bottom: 1px solid #f0f0f0;
            }
            
            .history-main {
                flex: 1;
            }
            
            .history-title {
                font-weight: 500;
                margin-bottom: 4px;
            }
            
            .history-time {
                font-size: 12px;
                color: #999;
            }
            
            .history-status {
                display: flex;
                flex-direction: column;
                align-items: flex-end;
                gap: 4px;
            }
            
            .history-duration {
                font-size: 12px;
                color: #666;
            }
        </style>
</head>
<body>
    <!-- Ê∑ªÂä†v-cloakÊåá‰ª§ÔºåÈò≤Ê≠¢VueÊ®°ÊùøÈó™Áé∞ -->
    <div id="app" v-cloak>
        <div class="app-container">
            <!-- È°∂ÈÉ®ÂØºËà™Ê†è -->
            <div class="top-bar">
                <!-- Â∑¶‰æßÂå∫Âüü -->
                <div class="action-btn" v-if="currentTab === 'forum'">
                    <i class="el-icon-location"></i>
                    <el-dropdown @command="changeSchool" trigger="click">
                        <span class="title">{{ selectedSchool.name }} <i class="el-icon-arrow-down el-icon--right"></i></span>
                        <el-dropdown-menu slot="dropdown">
                            <el-dropdown-item v-for="school in schools" :key="school.id" :command="school.id">
                                {{ school.name }}
                            </el-dropdown-item>
                        </el-dropdown-menu>
                    </el-dropdown>
                </div>
                <div v-else style="width: 20px;"></div>
                
                <!-- ‰∏≠Èó¥Ê†áÈ¢òÂå∫Âüü -->
                <div class="title" v-if="currentTab === 'profile'">‰∏™‰∫∫‰∏≠ÂøÉ</div>
                <div class="title" v-else-if="currentTab === 'checkin'">ÊâìÂç°</div>
                <div class="title" v-else-if="currentTab === 'tasks'">ÊâìÂç°Âä®ÊÄÅ</div>
                <div class="title" v-else-if="currentTab === 'focus'">‰∏ìÊ≥®Ê®°Âºè</div>
                <div class="title" v-else-if="currentTab === 'forum'"></div>
                
                <!-- Âè≥‰æßÊåâÈíÆÂå∫Âüü -->
                <div class="action-btn" v-if="currentTab === 'forum'">
                    <i class="el-icon-chat-line-square" @click="enterChatRoom"></i>
                </div>
                <div class="action-btn" v-else-if="currentTab === 'checkin'">
                    <i class="el-icon-plus" @click="dialogVisible = true; dialogType = 'task'; dialogTitle = 'ÂàõÂª∫Êñ∞‰ªªÂä°'"></i>
                </div>
                <div class="action-btn" v-else-if="currentTab === 'tasks'">
                    <i class="el-icon-refresh" @click="refreshCommunity"></i>
                </div>
                <div class="action-btn" v-else-if="currentTab === 'focus' && !focusMode.inSession">
                    <i class="el-icon-setting" @click="showFocusSettings"></i>
                </div>
                <div v-else style="width: 20px;"></div>
            </div>
            
            <!-- ÂÜÖÂÆπÂå∫Âüü -->
            <div class="content-area">
                <!-- È¶ñÈ°µÊ¨¢ËøéÊùøÂùó -->
                <div class="card" id="static-card" v-if="!initialized">
                    <div class="card-title">Ê¨¢ËøéËÆøÈóÆÊ†°Âõ≠APP</div>
                    <div style="padding: 15px;">
                        <p>È°µÈù¢Âä†ËΩΩ‰∏≠ÔºåËØ∑Á®çÂÄô...</p>
                    </div>
                </div>
                
                <!-- Âä†ËΩΩÈÅÆÁΩ©Â±Ç -->
                <transition name="fade">
                    <div v-if="loading" class="loading-overlay">
                        <div style="text-align: center;">
                            <i class="el-icon-loading" style="font-size: 30px; color: #409EFF;"></i>
                            <p style="margin-top: 10px; color: #606266;">Âä†ËΩΩ‰∏≠...</p>
                        </div>
                    </div>
                </transition>
                
                <!-- Ë∞ÉËØï‰ø°ÊÅØ -->
                <div class="card" v-if="false">
                    <div class="card-title">Âä†ËΩΩ‰∏≠...</div>
                </div>
                
                <!-- ÂêÑÊ®°ÂùóÂÜÖÂÆπ -->
                <div v-show="!loading">
                    <!-- ËÆ∫ÂùõÊùøÂùó -->
                    <div v-if="currentTab === 'forum'">
                        <div class="card">
                            <div class="card-title">
                                ÁÉ≠Èó®Â∏ñÂ≠ê
                                <el-button v-if="isLoggedIn" type="text" size="mini" @click="dialogVisible = true; dialogType = 'post'; dialogTitle = 'ÂàõÂª∫Êñ∞Â∏ñÂ≠ê'">
                                    ÂèëÂ∏ÉÂ∏ñÂ≠ê
                                </el-button>
                            </div>
                            <div class="post-item" v-for="post in filteredPosts" :key="post.id" @click="viewPostDetail(post)">
                                <div class="post-title">
                                    <span class="title-text">{{ post.title }}</span>
                                    <i class="el-icon-arrow-right" style="font-size: 14px; color: #909399;"></i>
                                </div>
                                <div class="post-meta">
                                    <span><i class="el-icon-user" style="margin-right: 4px;"></i>{{ post.author }}</span>
                                    <span><i class="el-icon-time" style="margin-right: 4px;"></i>{{ post.time }}</span>
                                </div>
                            </div>
                            <div v-if="filteredPosts.length === 0" style="text-align: center; padding: 20px 0; color: #999;">
                                ÊöÇÊó†Â∏ñÂ≠ê
                            </div>
                        </div>
                        
                        <!-- Áî®Êà∑Ëá™Â∑±ÂèëÂ∏ÉÁöÑÂ∏ñÂ≠ê (ÂåÖÊã¨ÂæÖÂÆ°Ê†∏ÁöÑ) -->
                        <div class="card" v-if="userPosts.length > 0">
                            <div class="card-title">
                                ÊàëÁöÑÂ∏ñÂ≠ê
                            </div>
                            <div class="post-item" v-for="post in userPosts" :key="post.id" @click="viewPostDetail(post)">
                                <div class="post-title">
                                    <span class="title-text">{{ post.title }}</span>
                                    <el-tag size="mini" :type="getStatusType(post.status)" style="margin-left: 10px;">
                                        {{ post.status_display }}
                                    </el-tag>
                                </div>
                                <div class="post-meta">
                                    <span><i class="el-icon-user" style="margin-right: 4px;"></i>{{ post.author }}</span>
                                    <span><i class="el-icon-time" style="margin-right: 4px;"></i>{{ post.time }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÊâìÂç°ÊùøÂùó -->
                    <div v-if="currentTab === 'checkin'">
                        <div class="card">
                            <div class="card-title">
                                ÊâìÂç°‰ªªÂä°
                                <el-button type="text" size="mini" @click="dialogVisible = true; dialogType = 'task'; dialogTitle = 'ÂàõÂª∫Êñ∞‰ªªÂä°'">
                                    ÂàõÂª∫‰ªªÂä°
                                </el-button>
                            </div>
                            <div class="task-item" v-for="checkin in filteredCheckins" :key="checkin.id">
                                <div class="task-title">{{ checkin.title }}</div>
                                <div class="task-info" v-if="checkin.time">Êó∂Èó¥Ë¶ÅÊ±Ç: {{ checkin.time }}</div>
                                <div class="task-info" v-if="checkin.description">{{ checkin.description }}</div>
                                <div class="task-info" v-if="checkin.created_at">ÂàõÂª∫‰∫é: {{ checkin.created_at }}</div>
                                <div class="task-actions">
                                    <el-button 
                                        size="mini" 
                                        type="success" 
                                        :disabled="checkin.checked_today" 
                                        @click="doCheckin(checkin)">
                                        {{ checkin.checked_today ? '‰ªäÊó•Â∑≤ÊâìÂç°' : 'ÊâìÂç°' }}
                                    </el-button>
                                    <el-button 
                                        size="mini" 
                                        type="danger" 
                                        v-if="checkin.is_creator"
                                        @click="deleteCheckin(checkin)">
                                        Âà†Èô§
                                    </el-button>
                                </div>
                            </div>
                            <div v-if="filteredCheckins.length === 0" style="text-align: center; padding: 20px 0; color: #999;">
                                ÊöÇÊó†ÊâìÂç°‰ªªÂä°ÔºåÂàõÂª∫‰∏Ä‰∏™Êñ∞‰ªªÂä°ÂêßÔºÅ
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÊâìÂç°Á§æÂå∫ÊùøÂùó -->
                    <div v-if="currentTab === 'tasks'">
                        <div class="card">
                            <div class="card-title">
                                ÊâìÂç°Âä®ÊÄÅ
                                <el-button type="text" size="mini" @click="refreshCommunity">Âà∑Êñ∞</el-button>
                            </div>
                            <div v-if="communityCheckins.length === 0" style="text-align: center; padding: 20px 0; color: #999;">
                                ÊöÇÊó†ÊâìÂç°Âä®ÊÄÅ
                            </div>
                            <div class="community-item" v-for="record in communityCheckins" :key="record.id">
                                <div class="community-header">
                                    <span class="community-user">{{ record.username }}</span>
                                    <span class="community-time">{{ record.checked_at }}</span>
                                </div>
                                <div class="community-content">
                                    ÊâìÂç°‰∫Ü <span class="community-task">{{ record.checkin_title }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ‰∏ìÊ≥®Ê®°ÂºèÊùøÂùó -->
                    <div v-if="currentTab === 'focus'">
                        <!-- Èùû‰∏ìÊ≥®Áä∂ÊÄÅ - ÊòæÁ§∫ÂºÄÂßãÁïåÈù¢ -->
                        <div v-if="!focusMode.inSession">
                            <div class="card">
                                <div class="card-title">
                                    üéØ ‰∏ìÊ≥®Ê®°Âºè
                                    <el-button type="text" size="mini" @click="showFocusSettings">ËÆæÁΩÆ</el-button>
                                </div>
                                
                                <!-- ‰ªäÊó•ÁªüËÆ° -->
                                <div class="focus-stats">
                                    <div class="stat-item">
                                        <div class="stat-number">{{ focusMode.stats.today.completed_sessions || 0 }}</div>
                                        <div class="stat-label">‰ªäÊó•ÂÆåÊàê</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-number">{{ formatDuration(focusMode.stats.today.total_minutes || 0) }}</div>
                                        <div class="stat-label">‰ªäÊó•Êó∂Èïø</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-number">{{ focusMode.stats.total.completed_sessions || 0 }}</div>
                                        <div class="stat-label">ÊÄªÂÆåÊàê</div>
                                    </div>
                                </div>
                                
                                <!-- ÂºÄÂßã‰∏ìÊ≥®ÊåâÈíÆ -->
                                <div class="focus-start-section">
                                    <el-button 
                                        type="primary" 
                                        size="large" 
                                        round
                                        @click="showStartFocusDialog"
                                        style="width: 100%; height: 60px; font-size: 18px; margin-top: 20px;">
                                        <i class="el-icon-timer" style="margin-right: 8px;"></i>
                                        ÂºÄÂßã‰∏ìÊ≥®
                                    </el-button>
                                </div>
                            </div>
                            
                            <!-- ÂéÜÂè≤ËÆ∞ÂΩï -->
                            <div class="card" v-if="focusHistory.length > 0">
                                <div class="card-title">
                                    üìä ÊúÄËøëËÆ∞ÂΩï
                                    <el-button type="text" size="mini" @click="showAllHistory">Êü•ÁúãÂÖ®ÈÉ®</el-button>
                                </div>
                                <div class="focus-history-item" v-for="session in focusHistory.slice(0, 5)" :key="session.id">
                                    <div class="history-main">
                                        <div class="history-title">{{ session.task_title }}</div>
                                        <div class="history-time">{{ session.start_time }}</div>
                                    </div>
                                    <div class="history-status">
                                        <el-tag 
                                            size="mini" 
                                            :type="session.completed ? 'success' : (session.interrupted ? 'danger' : 'info')">
                                            {{ session.completed ? 'ÂÆåÊàê' : (session.interrupted ? '‰∏≠Êñ≠' : 'ËøõË°å‰∏≠') }}
                                        </el-tag>
                                        <div class="history-duration">{{ session.actual_duration || session.planned_duration }}ÂàÜÈíü</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ‰∏ìÊ≥®Áä∂ÊÄÅ - ÊòæÁ§∫ËÆ°Êó∂Âô® -->
                        <div v-else class="focus-session-container">
                            <div class="focus-header">
                                <h2>{{ focusMode.currentSession.task_title }}</h2>
                                <p v-if="focusMode.currentSession.task_description">{{ focusMode.currentSession.task_description }}</p>
                            </div>
                            
                            <div class="focus-timer">
                                <div class="timer-circle">
                                    <div class="timer-display">
                                        {{ formatTime(focusMode.timer.remaining) }}
                                    </div>
                                    <div class="timer-type">
                                        {{ focusMode.currentSession.session_type === 'work' ? '‰∏ìÊ≥®Êó∂Èó¥' : '‰ºëÊÅØÊó∂Èó¥' }}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="focus-controls">
                                <el-button 
                                    v-if="!focusMode.timer.isRunning" 
                                    type="success" 
                                    size="large" 
                                    round
                                    @click="startTimer">
                                    <i class="el-icon-video-play"></i> ÂºÄÂßã
                                </el-button>
                                <el-button 
                                    v-else-if="!focusMode.timer.isPaused" 
                                    type="warning" 
                                    size="large" 
                                    round
                                    @click="pauseTimer">
                                    <i class="el-icon-video-pause"></i> ÊöÇÂÅú
                                </el-button>
                                <el-button 
                                    v-else 
                                    type="success" 
                                    size="large" 
                                    round
                                    @click="resumeTimer">
                                    <i class="el-icon-video-play"></i> ÁªßÁª≠
                                </el-button>
                                <el-button 
                                    type="danger" 
                                    size="large" 
                                    round
                                    @click="stopSession">
                                    <i class="el-icon-close"></i> ÁªìÊùü
                                </el-button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ‰∏™‰∫∫‰∏≠ÂøÉÊùøÂùó -->
                    <div v-if="currentTab === 'profile'">
                        <div class="card">
                            <div class="avatar-container">
                                <div class="avatar">{{ avatarInitial }}</div>
                                <div class="user-name">{{ displayUsername }}</div>
                                <div class="user-info">{{ userInfo.email }}</div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="profile-menu">
                                <div class="menu-item" @click="showProfile">
                                    <div class="menu-item-left">
                                        <i class="el-icon-user menu-icon"></i>
                                        <span>‰∏™‰∫∫ËµÑÊñô</span>
                                    </div>
                                    <i class="el-icon-arrow-right"></i>
                                </div>
                                <div class="menu-item" @click="showSettings">
                                    <div class="menu-item-left">
                                        <i class="el-icon-setting menu-icon"></i>
                                        <span>ËÆæÁΩÆ</span>
                                    </div>
                                    <i class="el-icon-arrow-right"></i>
                                </div>
                                <div class="menu-item" @click="showSecurity">
                                    <div class="menu-item-left">
                                        <i class="el-icon-lock menu-icon"></i>
                                        <span>ÂÆâÂÖ®‰∏≠ÂøÉ</span>
                                    </div>
                                    <i class="el-icon-arrow-right"></i>
                                </div>
                                <div v-if="userInfo.is_staff" class="menu-item" @click="goToAdminPage">
                                    <div class="menu-item-left">
                                        <i class="el-icon-key menu-icon"></i>
                                        <span>ÁÆ°ÁêÜÂëòÂêéÂè∞</span>
                                    </div>
                                    <i class="el-icon-arrow-right"></i>
                                </div>
                                <div class="menu-item" @click="logout">
                                    <div class="menu-item-left">
                                        <i class="el-icon-switch-button menu-icon" style="color: #F56C6C;"></i>
                                        <span style="color: #F56C6C;">ÈÄÄÂá∫ÁôªÂΩï</span>
                                    </div>
                                    <i class="el-icon-arrow-right"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Â∫ïÈÉ®ÂØºËà™ -->
            <div class="bottom-nav">
                <div 
                    class="nav-item" 
                    :class="{ active: currentTab === 'forum' }" 
                    @click="currentTab = 'forum'">
                    <i class="nav-icon el-icon-chat-line-square"></i>
                    <span>ËÆ∫Âùõ</span>
                </div>
                <div 
                    class="nav-item" 
                    :class="{ active: currentTab === 'checkin' }" 
                    @click="currentTab = 'checkin'">
                    <i class="nav-icon el-icon-date"></i>
                    <span>ÊâìÂç°</span>
                </div>
                <div 
                    class="nav-item" 
                    :class="{ active: currentTab === 'tasks' }" 
                    @click="currentTab = 'tasks'">
                    <i class="nav-icon el-icon-s-data"></i>
                    <span>Âä®ÊÄÅ</span>
                </div>
                <div 
                    class="nav-item" 
                    :class="{ active: currentTab === 'focus' }" 
                    @click="currentTab = 'focus'">
                    <i class="nav-icon el-icon-timer"></i>
                    <span>‰∏ìÊ≥®</span>
                </div>
                <div 
                    class="nav-item" 
                    :class="{ active: currentTab === 'profile' }" 
                    @click="currentTab = 'profile'">
                    <i class="nav-icon el-icon-user"></i>
                    <span>ÊàëÁöÑ</span>
                </div>
            </div>
            
            <!-- ÂØπËØùÊ°Ü -->
            <el-dialog 
                :title="dialogTitle" 
                :visible.sync="dialogVisible"
                width="90%">
                <div v-if="dialogType === 'profile'">
                    <el-form label-width="80px">
                        <el-form-item label="Áî®Êà∑Âêç">
                            <el-input v-model="userInfo.username" disabled></el-input>
                        </el-form-item>
                        <el-form-item label="ÈÇÆÁÆ±">
                            <el-input v-model="userInfo.email" disabled></el-input>
                        </el-form-item>
                        <el-form-item label="ÊâãÊú∫Âè∑" v-if="userInfo.phone">
                            <el-input v-model="userInfo.phone" disabled></el-input>
                        </el-form-item>
                    </el-form>
                </div>
                <div v-else-if="dialogType === 'security'">
                    <div style="padding: 10px 0;">
                        <div class="menu-item">
                            <div class="menu-item-left">
                                <i class="el-icon-message menu-icon"></i>
                                <div>
                                    <div>ÈÇÆÁÆ±ÁªëÂÆö</div>
                                    <div style="font-size: 12px; color: #999;">{{ userInfo.email || 'Êú™ÁªëÂÆö' }}</div>
                                </div>
                            </div>
                            <el-button size="mini" type="text" @click="changeEmail">{{ userInfo.email ? 'Êõ¥Êç¢' : 'ÁªëÂÆö' }}</el-button>
                        </div>
                        <div class="menu-item">
                            <div class="menu-item-left">
                                <i class="el-icon-mobile-phone menu-icon"></i>
                                <div>
                                    <div>ÊâãÊú∫ÁªëÂÆö</div>
                                    <div style="font-size: 12px; color: #999;">{{ userInfo.phone || 'Êú™ÁªëÂÆö' }}</div>
                                </div>
                            </div>
                            <el-button size="mini" type="text">{{ userInfo.phone ? 'Êõ¥Êç¢' : 'ÁªëÂÆö' }}</el-button>
                        </div>
                        <div class="menu-item">
                            <div class="menu-item-left">
                                <i class="el-icon-key menu-icon"></i>
                                <div>‰øÆÊîπÂØÜÁ†Å</div>
                            </div>
                            <el-button size="mini" type="text">‰øÆÊîπ</el-button>
                        </div>
                    </div>
                </div>
                <div v-else-if="dialogType === 'settings'">
                    <div style="padding: 10px 0;">
                        <div class="menu-item">
                            <div class="menu-item-left">
                                <i class="el-icon-bell menu-icon"></i>
                                <span>Ê∂àÊÅØÈÄöÁü•</span>
                            </div>
                            <el-switch v-model="settings.notifications"></el-switch>
                        </div>
                        <div class="menu-item">
                            <div class="menu-item-left">
                                <i class="el-icon-moon menu-icon"></i>
                                <span>Ê∑±Ëâ≤Ê®°Âºè</span>
                            </div>
                            <el-switch v-model="settings.darkMode" @change="toggleDarkMode"></el-switch>
                        </div>
                        <div class="menu-item">
                            <div class="menu-item-left">
                                <i class="el-icon-document menu-icon"></i>
                                <span>ÈöêÁßÅÊîøÁ≠ñ</span>
                            </div>
                            <i class="el-icon-arrow-right"></i>
                        </div>
                        <div class="menu-item">
                            <div class="menu-item-left">
                                <i class="el-icon-question menu-icon"></i>
                                <span>ÂÖ≥‰∫éÊàë‰ª¨</span>
                            </div>
                            <i class="el-icon-arrow-right"></i>
                        </div>
                    </div>
                </div>
                <div v-else-if="dialogType === 'task'">
                    <el-form :model="newTask" label-width="80px">
                        <el-form-item label="‰ªªÂä°ÂêçÁß∞" required>
                            <el-input v-model="newTask.title" placeholder="ËØ∑ËæìÂÖ•‰ªªÂä°ÂêçÁß∞"></el-input>
                        </el-form-item>
                        <el-form-item label="Êó∂Èó¥Ë¶ÅÊ±Ç">
                            <el-input v-model="newTask.time" placeholder="Â¶ÇÔºöÊØèÂ§©Êó©‰∏ä8ÁÇπ"></el-input>
                        </el-form-item>
                        <el-form-item label="‰ªªÂä°ÊèèËø∞">
                            <el-input 
                                type="textarea" 
                                v-model="newTask.description" 
                                placeholder="ËØ∑ËæìÂÖ•‰ªªÂä°ÊèèËø∞"
                                :rows="3"></el-input>
                        </el-form-item>
                    </el-form>
                    <span slot="footer" class="dialog-footer">
                        <el-button @click="dialogVisible = false">Âèñ Ê∂à</el-button>
                        <el-button type="primary" @click="createTask">Âàõ Âª∫</el-button>
                    </span>
                </div>
                <div v-else-if="dialogType === 'changeEmail'">
                    <el-form :model="emailForm" label-width="80px">
                        <el-form-item label="ÂéüÈÇÆÁÆ±" required>
                            <el-input v-model="userInfo.email" disabled></el-input>
                        </el-form-item>
                        <el-form-item label="È™åËØÅÁ†Å" required>
                            <div style="display: flex;">
                                <el-input v-model="emailForm.oldCode" placeholder="ËØ∑ËæìÂÖ•È™åËØÅÁ†Å"></el-input>
                                <el-button 
                                    type="primary" 
                                    size="small" 
                                    style="margin-left: 10px; width: 120px;" 
                                    :disabled="oldCodeSending"
                                    @click="sendOldEmailCode">
                                    {{ oldCodeSending ? `${oldCodeTimer}s` : 'Ëé∑ÂèñÈ™åËØÅÁ†Å' }}
                                </el-button>
                            </div>
                        </el-form-item>
                        <el-form-item label="Êñ∞ÈÇÆÁÆ±" required>
                            <el-input v-model="emailForm.newEmail" placeholder="ËØ∑ËæìÂÖ•Êñ∞ÈÇÆÁÆ±"></el-input>
                        </el-form-item>
                        <el-form-item label="È™åËØÅÁ†Å" required>
                            <div style="display: flex;">
                                <el-input v-model="emailForm.newCode" placeholder="ËØ∑ËæìÂÖ•È™åËØÅÁ†Å"></el-input>
                                <el-button 
                                    type="primary" 
                                    size="small" 
                                    style="margin-left: 10px; width: 120px;" 
                                    :disabled="newCodeSending || !emailForm.newEmail"
                                    @click="sendNewEmailCode">
                                    {{ newCodeSending ? `${newCodeTimer}s` : 'Ëé∑ÂèñÈ™åËØÅÁ†Å' }}
                                </el-button>
                            </div>
                        </el-form-item>
                    </el-form>
                    <span slot="footer" class="dialog-footer">
                        <el-button @click="dialogVisible = false">Âèñ Ê∂à</el-button>
                        <el-button type="primary" @click="updateEmail">Á°Æ ËÆ§</el-button>
                    </span>
                </div>
                <div v-else-if="dialogType === 'post'">
                    <el-form :model="newPost" label-width="80px">
                        <el-form-item label="Ê†áÈ¢ò" required>
                            <el-input v-model="newPost.title" placeholder="ËØ∑ËæìÂÖ•Â∏ñÂ≠êÊ†áÈ¢ò"></el-input>
                        </el-form-item>
                        <el-form-item label="ÂÜÖÂÆπ" required>
                            <el-input 
                                type="textarea" 
                                v-model="newPost.content" 
                                placeholder="ËØ∑ËæìÂÖ•Â∏ñÂ≠êÂÜÖÂÆπ"
                                :rows="5"></el-input>
                        </el-form-item>
                    </el-form>
                    <span slot="footer" class="dialog-footer">
                        <el-button @click="dialogVisible = false">Âèñ Ê∂à</el-button>
                        <el-button type="primary" @click="createPost">Âèë Â∏É</el-button>
                    </span>
                </div>
                <div v-else-if="dialogType === 'startFocus'">
                    <el-form :model="focusTaskForm" label-width="80px">
                        <el-form-item label="‰ªªÂä°Ê†áÈ¢ò" required>
                            <el-input v-model="focusTaskForm.title" placeholder="ËØ∑ËæìÂÖ•Ë¶Å‰∏ìÊ≥®ÁöÑ‰ªªÂä°"></el-input>
                        </el-form-item>
                        <el-form-item label="‰ªªÂä°ÊèèËø∞">
                            <el-input 
                                type="textarea" 
                                v-model="focusTaskForm.description" 
                                placeholder="‰ªªÂä°ÁöÑËØ¶ÁªÜÊèèËø∞ÔºàÂèØÈÄâÔºâ"
                                :rows="3"></el-input>
                        </el-form-item>
                        <el-form-item label="‰∏ìÊ≥®Êó∂Èïø">
                            <el-select v-model="focusTaskForm.duration" style="width: 100%;">
                                <el-option label="15ÂàÜÈíü" :value="15"></el-option>
                                <el-option label="25ÂàÜÈíü (Êé®Ëçê)" :value="25"></el-option>
                                <el-option label="30ÂàÜÈíü" :value="30"></el-option>
                                <el-option label="45ÂàÜÈíü" :value="45"></el-option>
                                <el-option label="60ÂàÜÈíü" :value="60"></el-option>
                            </el-select>
                        </el-form-item>
                    </el-form>
                    <span slot="footer" class="dialog-footer">
                        <el-button @click="dialogVisible = false">Âèñ Ê∂à</el-button>
                        <el-button type="primary" @click="startFocusSession">ÂºÄÂßã‰∏ìÊ≥®</el-button>
                    </span>
                </div>
                <div v-else-if="dialogType === 'focusSettings'">
                    <el-form :model="focusMode.settings" label-width="120px">
                        <el-form-item label="Â∑•‰ΩúÊó∂Èïø">
                            <el-input-number 
                                v-model="focusMode.settings.work_duration" 
                                :min="5" 
                                :max="120" 
                                style="width: 100%;"
                                controls-position="right">
                            </el-input-number>
                            <span style="color: #999; font-size: 12px;">ÂàÜÈíü</span>
                        </el-form-item>
                        <el-form-item label="Áü≠‰ºëÊÅØÊó∂Èïø">
                            <el-input-number 
                                v-model="focusMode.settings.break_duration" 
                                :min="1" 
                                :max="30" 
                                style="width: 100%;"
                                controls-position="right">
                            </el-input-number>
                            <span style="color: #999; font-size: 12px;">ÂàÜÈíü</span>
                        </el-form-item>
                        <el-form-item label="Èïø‰ºëÊÅØÊó∂Èïø">
                            <el-input-number 
                                v-model="focusMode.settings.long_break_duration" 
                                :min="5" 
                                :max="60" 
                                style="width: 100%;"
                                controls-position="right">
                            </el-input-number>
                            <span style="color: #999; font-size: 12px;">ÂàÜÈíü</span>
                        </el-form-item>
                        <el-form-item label="Èïø‰ºëÊÅØÈó¥Èöî">
                            <el-input-number 
                                v-model="focusMode.settings.sessions_before_long_break" 
                                :min="2" 
                                :max="8" 
                                style="width: 100%;"
                                controls-position="right">
                            </el-input-number>
                            <span style="color: #999; font-size: 12px;">‰∏™‰∏ìÊ≥®‰ºöËØùÂêé</span>
                        </el-form-item>
                        <el-form-item label="Â£∞Èü≥ÊèêÈÜí">
                            <el-switch v-model="focusMode.settings.sound_enabled"></el-switch>
                        </el-form-item>
                        <el-form-item label="Ëá™Âä®ÂºÄÂßã‰ºëÊÅØ">
                            <el-switch v-model="focusMode.settings.auto_start_breaks"></el-switch>
                        </el-form-item>
                        <el-form-item label="Ëá™Âä®ÂºÄÂßãÂ∑•‰Ωú">
                            <el-switch v-model="focusMode.settings.auto_start_work"></el-switch>
                        </el-form-item>
                    </el-form>
                    <span slot="footer" class="dialog-footer">
                        <el-button @click="dialogVisible = false">Âèñ Ê∂à</el-button>
                        <el-button type="primary" @click="updateFocusSettings">‰øù Â≠ò</el-button>
                    </span>
                </div>
                <div v-else-if="dialogType === 'focusHistory'">
                    <div style="max-height: 400px; overflow-y: auto;">
                        <div class="focus-history-item" v-for="session in focusHistory" :key="session.id">
                            <div class="history-main">
                                <div class="history-title">{{ session.task_title }}</div>
                                <div class="history-time">{{ session.start_time }}</div>
                                <div v-if="session.task_description" style="font-size: 12px; color: #999; margin-top: 4px;">
                                    {{ session.task_description }}
                                </div>
                            </div>
                            <div class="history-status">
                                <el-tag 
                                    size="mini" 
                                    :type="session.completed ? 'success' : (session.interrupted ? 'danger' : 'info')">
                                    {{ session.completed ? 'ÂÆåÊàê' : (session.interrupted ? '‰∏≠Êñ≠' : 'ËøõË°å‰∏≠') }}
                                </el-tag>
                                <div class="history-duration">
                                    ËÆ°Âàí: {{ session.planned_duration }}ÂàÜÈíü
                                </div>
                                <div class="history-duration" v-if="session.actual_duration">
                                    ÂÆûÈôÖ: {{ session.actual_duration }}ÂàÜÈíü
                                </div>
                            </div>
                        </div>
                        <div v-if="focusHistory.length === 0" style="text-align: center; padding: 40px 0; color: #999;">
                            ÊöÇÊó†‰∏ìÊ≥®ËÆ∞ÂΩï
                        </div>
                    </div>
                    <span slot="footer" class="dialog-footer">
                        <el-button @click="dialogVisible = false">ÂÖ≥ Èó≠</el-button>
                    </span>
                </div>
            </el-dialog>
        </div>
    </div>

    <!-- Êï¥ÂêàÁöÑJavaScriptËÑöÊú¨ -->
    <script>
        // Ê∑ªÂä†Ë∞ÉËØïÂäüËÉΩ
        console.originalLog = console.log;
        console.log = function() {
            console.originalLog.apply(console, arguments);
            var message = Array.prototype.slice.call(arguments).join(' ');
            var debugLog = document.getElementById('debug-log');
            if (debugLog) {
                var p = document.createElement('p');
                p.textContent = message;
                debugLog.appendChild(p);
                debugLog.scrollTop = debugLog.scrollHeight;
            }
        };
        
        // Á°Æ‰øùÈùôÊÄÅÂÜÖÂÆπÊòæÁ§∫ÔºåÁõ¥Âà∞VueÂä†ËΩΩÂÆåÊàê
        var staticContent = document.getElementById('static-content');
        if (staticContent) {
            staticContent.style.display = 'block';
        }
        
        // DOMContentLoaded‰∫ã‰ª∂ÂêéÂàùÂßãÂåñVue
        document.addEventListener('DOMContentLoaded', function() {
            // ÂàõÂª∫VueÂÆû‰æã
            window.vueApp = new Vue({
                el: '#app',
                data: {
                    initialized: false,
                    loading: false,
                    isLoggedIn: false,
                    userInfo: { username: 'Ê∏∏ÂÆ¢Áî®Êà∑', email: 'Êú™ÁôªÂΩï' },
                    currentTab: 'checkin',
                    selectedSchool: { id: null, name: 'ËØ∑ÈÄâÊã©Â≠¶Ê†°' },
                    schools: [],
                    dialogVisible: false,
                    dialogType: '',
                    dialogTitle: '',
                    settings: {
                        notifications: true,
                        darkMode: false
                    },
                    posts: [],
                    checkins: [],
                    communityCheckins: [],
                    activeTab: 'tasks',
                    newTask: {
                        title: '',
                        time: '',
                        description: ''
                    },
                    emailForm: {
                        oldCode: '',
                        newEmail: '',
                        newCode: ''
                    },
                    oldCodeSending: false,
                    oldCodeTimer: 60,
                    newCodeSending: false,
                    newCodeTimer: 60,
                    newPost: {
                        title: '',
                        content: ''
                    },
                    userPosts: [],
                    // ‰∏ìÊ≥®Ê®°ÂºèÁõ∏ÂÖ≥Êï∞ÊçÆ
                    focusMode: {
                        enabled: false,
                        inSession: false,
                        currentSession: null,
                        timer: {
                            duration: 0,
                            remaining: 0,
                            isRunning: false,
                            isPaused: false
                        },
                        settings: {
                            work_duration: 25,
                            break_duration: 5,
                            long_break_duration: 15,
                            sessions_before_long_break: 4,
                            sound_enabled: true,
                            auto_start_breaks: false,
                            auto_start_work: false,
                            focus_theme: 'default'
                        },
                        stats: {
                            today: { sessions_count: 0, completed_sessions: 0, total_minutes: 0 },
                            week: { sessions_count: 0, completed_sessions: 0, total_minutes: 0 },
                            month: { sessions_count: 0, completed_sessions: 0, total_minutes: 0 },
                            total: { sessions_count: 0, completed_sessions: 0, total_minutes: 0 }
                        }
                    },
                    focusTaskForm: {
                        title: '',
                        description: '',
                        duration: 25
                    },
                    timerInterval: null,
                    focusHistory: []
                },
                computed: {
                    avatarInitial() {
                        return this.userInfo.username ? this.userInfo.username[0].toUpperCase() : '?';
                    },
                    displayUsername() {
                        return this.userInfo.username || 'Áî®Êà∑';
                    },
                    filteredPosts() {
                        // ÂêéÁ´ØAPIÂ∑≤ÁªèÊåâÂ≠¶Ê†°ËøáÊª§ÔºåÊó†ÈúÄÂÜçÊ¨°ËøáÊª§
                        return this.posts;
                    },
                    filteredCheckins() {
                        // ÂêéÁ´ØAPIÂ∑≤ÁªèÊåâÂ≠¶Ê†°ËøáÊª§ÔºåÊó†ÈúÄÂÜçÊ¨°ËøáÊª§
                        return this.checkins;
                    }
                },
                watch: {
                    currentTab(newTab, oldTab) {
                        // ÂÖàÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
                        this.loading = true;
                        
                        // ÂΩìÂàáÊç¢Âà∞ËÆ∫ÂùõÊ†áÁ≠æÊó∂ÔºåÂä†ËΩΩËÆ∫ÂùõÊï∞ÊçÆ
                        if (newTab === 'forum' && this.selectedSchool.id) {
                            this.fetchForumData();
                        }
                        // ÂΩìÂàáÊç¢Âà∞ÊâìÂç°Ê†áÁ≠æÊó∂ÔºåÂä†ËΩΩÊâìÂç°Êï∞ÊçÆ
                        else if (newTab === 'checkin') {
                            this.refreshCheckins();
                        }
                        // ÂΩìÂàáÊç¢Âà∞Âä®ÊÄÅÊ†áÁ≠æÊó∂ÔºåÂä†ËΩΩÂä®ÊÄÅÊï∞ÊçÆ
                        else if (newTab === 'tasks') {
                            this.refreshCommunity();
                        } else {
                            // Â¶ÇÊûúÊòØÂÖ∂‰ªñÊ†áÁ≠æÔºàÂ¶Ç‰∏™‰∫∫‰∏≠ÂøÉÔºâÔºåÁõ¥Êé•ÂÖ≥Èó≠Âä†ËΩΩÁä∂ÊÄÅÔºå‰ΩÜÊ∑ªÂä†Áü≠ÊöÇÂª∂Ëøü
                            setTimeout(() => {
                                this.loading = false;
                            }, 200);
                        }
                    }
                },
                methods: {
                    fetchSchools() {
                        this.loading = true;
                        axios.get('/forum/api/schools/')
                            .then(response => {
                                this.schools = response.data;
                                if (this.schools.length > 0 && !this.selectedSchool.id) {
                                    this.selectedSchool = this.schools[0];
                                }
                                this.loading = false;
                                // Ëé∑ÂèñÂàùÂßãÂ≠¶Ê†°ÁöÑÊï∞ÊçÆ
                                this.fetchSchoolData();
                            })
                            .catch(error => {
                                console.error('Ëé∑ÂèñÂ≠¶Ê†°ÂàóË°®Â§±Ë¥•:', error);
                                this.loading = false;
                                this.$message.error('Ëé∑ÂèñÂ≠¶Ê†°Êï∞ÊçÆÂ§±Ë¥•ÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï');
                            });
                    },
                    fetchSchoolData() {
                        if (!this.selectedSchool.id) return;
                        
                        this.loading = true;
                        // Ê†πÊçÆÂΩìÂâçÊ†áÁ≠æÂä†ËΩΩÁõ∏Â∫îÊï∞ÊçÆ
                        if (this.currentTab === 'forum') {
                            this.fetchForumData();
                        } else {
                            // Âπ∂Ë°åËØ∑Ê±ÇÊâìÂç°ÂíåÁ§æÂå∫Êï∞ÊçÆ
                            Promise.all([
                                axios.get(`/checkin/checkins/`),
                                axios.get('/checkin/community/')
                            ])
                            .then(([checkinsResponse, communityResponse]) => {
                                this.checkins = checkinsResponse.data;
                                this.communityCheckins = communityResponse.data;
                                this.loading = false;
                            })
                            .catch(error => {
                                console.error('Ëé∑ÂèñÊï∞ÊçÆÂ§±Ë¥•:', error);
                                this.loading = false;
                                this.$message.error('Ëé∑ÂèñÊï∞ÊçÆÂ§±Ë¥•ÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï');
                            });
                        }
                    },
                    changeSchool(schoolId) {
                        const school = this.schools.find(s => s.id === schoolId);
                        if (school) {
                            this.selectedSchool = school;
                            // ÂàáÊç¢Â≠¶Ê†°ÂêéÈáçÊñ∞Ëé∑ÂèñËÆ∫ÂùõÊï∞ÊçÆ
                            if (this.currentTab === 'forum') {
                                this.fetchForumData();
                            }
                        }
                    },
                    showProfile() {
                        this.dialogType = 'profile';
                        this.dialogTitle = '‰∏™‰∫∫ËµÑÊñô';
                        this.dialogVisible = true;
                    },
                    changeEmail() {
                        this.dialogType = 'changeEmail';
                        this.dialogTitle = 'Êõ¥Êç¢ÈÇÆÁÆ±';
                        this.dialogVisible = true;
                    },
                    showSecurity() {
                        this.dialogType = 'security';
                        this.dialogTitle = 'ÂÆâÂÖ®‰∏≠ÂøÉ';
                        this.dialogVisible = true;
                    },
                    showSettings() {
                        this.dialogType = 'settings';
                        this.dialogTitle = 'ËÆæÁΩÆ';
                        this.dialogVisible = true;
                    },
                    logout() {
                        localStorage.removeItem('user');
                        localStorage.removeItem('token');
                        delete axios.defaults.headers.common['Authorization'];
                        this.$message.success('Â∑≤ÈÄÄÂá∫ÁôªÂΩï');
                        setTimeout(() => { window.location.href = '/accounts/auth/'; }, 500);
                    },
                    doCheckin(checkin) {
                        this.loading = true;
                        // Ë∞ÉÁî®ÂêéÁ´ØAPIËøõË°åÊâìÂç°
                        axios.post(`/checkin/checkins/${checkin.id}/check/`)
                            .then(response => {
                                // Êõ¥Êñ∞Êú¨Âú∞ÊâìÂç°Áä∂ÊÄÅ
                                const index = this.checkins.findIndex(c => c.id === checkin.id);
                                if (index !== -1) {
                                    this.checkins[index].checked_today = true;
                                    // Á°Æ‰øùËøîÂõûÁöÑÊï∞ÊçÆÂåÖÂê´checkin_recordÔºåÂπ∂ÂÆâÂÖ®Ëé∑ÂèñID
                                    const checkinRecord = response.data.checkin_record || {};
                                    this.checkins[index].today_checkin_id = checkinRecord.id;
                                    this.$message.success('ÊâìÂç°ÊàêÂäüÔºÅ');
                                }
                                
                                // Âà∑Êñ∞Á§æÂå∫Âä®ÊÄÅ
                                this.refreshCommunity();
                                
                                this.loading = false;
                            })
                            .catch(error => {
                                console.error('ÊâìÂç°Â§±Ë¥•:', error);
                                this.loading = false;
                                this.$message.error('Êìç‰ΩúÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
                            });
                    },
                    refreshCheckins() {
                        // ÈáçÊñ∞Ëé∑ÂèñÊâìÂç°Êï∞ÊçÆ
                        this.loading = true;
                        axios.get(`/checkin/checkins/`)
                            .then(response => {
                                this.checkins = response.data;
                                setTimeout(() => {
                                    this.loading = false;
                                }, 200); // Ê∑ªÂä†Áü≠ÊöÇÂª∂ËøüÔºåÁ°Æ‰øùÂä®ÁîªÂπ≥Êªë
                                this.$message.success('Â∑≤Âà∑Êñ∞ÊâìÂç°ÂàóË°®');
                            })
                            .catch(error => {
                                console.error('Âà∑Êñ∞ÊâìÂç°ÂàóË°®Â§±Ë¥•:', error);
                                this.loading = false;
                                this.$message.error('Âà∑Êñ∞Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
                            });
                    },
                    checkLoginStatus() {
                        const token = localStorage.getItem('token');
                        const user = localStorage.getItem('user');
                        
                        if (token && user) {
                            try {
                                this.userInfo = JSON.parse(user);
                                this.isLoggedIn = true;
                                
                                // ËÆæÁΩÆAuthorizationÂ§¥
                                axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;
                                
                                // Âè¶Â§ñÂú®ÊØè‰∏™ËØ∑Ê±Ç‰∏≠Ê∑ªÂä†X-Auth-TokenÔºåÁ°Æ‰øùÂú®Êüê‰∫õÁéØÂ¢ÉËÉΩË¢´Ê≠£Á°ÆÊã¶Êà™
                                axios.interceptors.request.use(config => {
                                    config.headers['X-Auth-Token'] = token;
                                    return config;
                                });
                                
                            } catch (e) {
                                console.error('Ëß£ÊûêÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•:', e);
                                this.isLoggedIn = false;
                            }
                        } else {
                            this.isLoggedIn = false;
                            this.userInfo = { username: 'Ê∏∏ÂÆ¢Áî®Êà∑', email: 'Êú™ÁôªÂΩï' };
                        }
                    },
                    // ===== ‰∏ìÊ≥®Ê®°ÂºèÁõ∏ÂÖ≥ÊñπÊ≥ï =====
                    loadFocusData() {
                        this.loadFocusSettings();
                        this.loadFocusStats();
                        this.loadFocusHistory();
                        this.checkActiveSession();
                    },
                    loadFocusSettings() {
                        axios.get('/focus/settings/')
                            .then(response => {
                                if (response.data.success) {
                                    this.focusMode.settings = response.data.settings;
                                }
                            })
                            .catch(error => {
                                console.error('Ëé∑Âèñ‰∏ìÊ≥®ËÆæÁΩÆÂ§±Ë¥•:', error);
                            });
                    },
                    loadFocusStats() {
                        axios.get('/focus/stats/')
                            .then(response => {
                                if (response.data.success) {
                                    this.focusMode.stats = response.data.stats;
                                }
                            })
                            .catch(error => {
                                console.error('Ëé∑Âèñ‰∏ìÊ≥®ÁªüËÆ°Â§±Ë¥•:', error);
                            });
                    },
                    loadFocusHistory() {
                        axios.get('/focus/history/')
                            .then(response => {
                                if (response.data.success) {
                                    this.focusHistory = response.data.sessions;
                                }
                            })
                            .catch(error => {
                                console.error('Ëé∑Âèñ‰∏ìÊ≥®ÂéÜÂè≤Â§±Ë¥•:', error);
                            });
                    },
                    checkActiveSession() {
                        axios.get('/focus/session/active/')
                            .then(response => {
                                if (response.data.success && response.data.session) {
                                    this.focusMode.currentSession = response.data.session;
                                    this.focusMode.inSession = true;
                                    this.setupTimerFromSession(response.data.session);
                                }
                            })
                            .catch(error => {
                                console.error('Ê£ÄÊü•Ê¥ªÂä®‰ºöËØùÂ§±Ë¥•:', error);
                            });
                    },
                    showStartFocusDialog() {
                        this.focusTaskForm = {
                            title: '',
                            description: '',
                            duration: this.focusMode.settings.work_duration
                        };
                        this.dialogType = 'startFocus';
                        this.dialogTitle = 'ÂºÄÂßã‰∏ìÊ≥®';
                        this.dialogVisible = true;
                    },
                    startFocusSession() {
                        if (!this.focusTaskForm.title) {
                            this.$message.error('ËØ∑ËæìÂÖ•‰ªªÂä°Ê†áÈ¢ò');
                            return;
                        }
                        
                        const data = {
                            task_title: this.focusTaskForm.title,
                            task_description: this.focusTaskForm.description,
                            planned_duration: this.focusTaskForm.duration,
                            session_type: 'work'
                        };
                        
                        axios.post('/focus/session/start/', data)
                            .then(response => {
                                if (response.data.success) {
                                    this.focusMode.currentSession = response.data.session;
                                    this.focusMode.inSession = true;
                                    this.initTimer(this.focusTaskForm.duration * 60);
                                    this.dialogVisible = false;
                                    this.$message.success('‰∏ìÊ≥®‰ºöËØùÂ∑≤ÂàõÂª∫ÔºåÁÇπÂáªÂºÄÂßãÊåâÈíÆÂºÄÂßãËÆ°Êó∂');
                                    // Ê≥®ÊÑèÔºöËøôÈáå‰∏çËá™Âä®ÂºÄÂßãËÆ°Êó∂Âô®ÔºåÁ≠âÁî®Êà∑ÊâãÂä®ÁÇπÂáªÂºÄÂßã
                                } else {
                                    this.$message.error(response.data.error || 'ÂºÄÂßãÂ§±Ë¥•');
                                }
                            })
                            .catch(error => {
                                console.error('ÂºÄÂßã‰∏ìÊ≥®Â§±Ë¥•:', error);
                                this.$message.error('ÂºÄÂßã‰∏ìÊ≥®Â§±Ë¥•');
                            });
                    },
                    initTimer(seconds) {
                        this.focusMode.timer.duration = seconds;
                        this.focusMode.timer.remaining = seconds;
                        this.focusMode.timer.isRunning = false;
                        this.focusMode.timer.isPaused = false;
                    },
                    setupTimerFromSession(session) {
                        // ËÆ°ÁÆóÂ∑≤ËøáÂéªÁöÑÊó∂Èó¥
                        const startTime = new Date(session.start_time);
                        const now = new Date();
                        const elapsed = Math.floor((now - startTime) / 1000);
                        const totalDuration = session.planned_duration * 60;
                        const remaining = Math.max(0, totalDuration - elapsed);
                        
                        this.initTimer(totalDuration);
                        this.focusMode.timer.remaining = remaining;
                        
                        if (remaining <= 0) {
                            // Êó∂Èó¥Â∑≤Âà∞ÔºåËá™Âä®ÁªìÊùü‰ºöËØù
                            this.$message.warning('Ê£ÄÊµãÂà∞Êú™ÂÆåÊàêÁöÑ‰∏ìÊ≥®‰ºöËØùÂ∑≤Ë∂ÖÊó∂ÔºåÂ∑≤Ëá™Âä®ÁªìÊùü');
                            this.endSession(false, true);
                        } else {
                            // ÊòæÁ§∫ÊÅ¢Â§çÊèêÁ§∫
                            this.$confirm(`Ê£ÄÊµãÂà∞Êú™ÂÆåÊàêÁöÑ‰∏ìÊ≥®‰ºöËØùÔºö"${session.task_title}"ÔºåÂâ©‰Ωô ${this.formatTime(remaining)}ÔºåÊòØÂê¶ÁªßÁª≠Ôºü`, 'ÊÅ¢Â§ç‰∏ìÊ≥®‰ºöËØù', {
                                confirmButtonText: 'ÁªßÁª≠‰∏ìÊ≥®',
                                cancelButtonText: 'ÁªìÊùü‰ºöËØù',
                                type: 'info'
                            }).then(() => {
                                // Áî®Êà∑ÈÄâÊã©ÁªßÁª≠ÔºåËá™Âä®ÂºÄÂßãËÆ°Êó∂Âô®
                                this.startTimer();
                            }).catch(() => {
                                // Áî®Êà∑ÈÄâÊã©ÁªìÊùü‰ºöËØù
                                this.endSession(false, true);
                            });
                        }
                    },
                    startTimer() {
                        // Èò≤Ê≠¢ÈáçÂ§çÂêØÂä®ËÆ°Êó∂Âô®
                        if (this.timerInterval) {
                            clearInterval(this.timerInterval);
                            this.timerInterval = null;
                        }
                        
                        this.focusMode.timer.isRunning = true;
                        this.focusMode.timer.isPaused = false;
                        
                        this.timerInterval = setInterval(() => {
                            if (this.focusMode.timer.remaining > 0) {
                                this.focusMode.timer.remaining--;
                            } else {
                                this.timerComplete();
                            }
                        }, 1000);
                    },
                    pauseTimer() {
                        this.focusMode.timer.isPaused = true;
                        this.focusMode.timer.isRunning = false;
                        if (this.timerInterval) {
                            clearInterval(this.timerInterval);
                            this.timerInterval = null;
                        }
                    },
                    resumeTimer() {
                        // Á°Æ‰øù‰πãÂâçÁöÑËÆ°Êó∂Âô®Â∑≤ÁªèÊ∏ÖÈô§
                        if (this.timerInterval) {
                            clearInterval(this.timerInterval);
                            this.timerInterval = null;
                        }
                        this.startTimer();
                    },
                    timerComplete() {
                        this.pauseTimer();
                        this.endSession(true);
                        this.$message.success('‰∏ìÊ≥®Êó∂Èó¥ÁªìÊùüÔºÅ');
                        
                        // Êí≠ÊîæÂ£∞Èü≥ÊèêÈÜíÔºàÂ¶ÇÊûúÂêØÁî®Ôºâ
                        if (this.focusMode.settings.sound_enabled) {
                            this.playNotificationSound();
                        }
                    },
                    stopSession() {
                        this.$confirm('Á°ÆÂÆöË¶ÅÁªìÊùüÂΩìÂâç‰∏ìÊ≥®‰ºöËØùÂêóÔºü', 'Á°ÆËÆ§', {
                            confirmButtonText: 'Á°ÆÂÆö',
                            cancelButtonText: 'ÂèñÊ∂à',
                            type: 'warning'
                        }).then(() => {
                            this.endSession(false, true);
                        });
                    },
                    endSession(completed = false, interrupted = false) {
                        if (!this.focusMode.currentSession) return;
                        
                        const data = {
                            session_id: this.focusMode.currentSession.id,
                            completed: completed,
                            interrupted: interrupted
                        };
                        
                        axios.post('/focus/session/end/', data)
                            .then(response => {
                                if (response.data.success) {
                                    this.focusMode.inSession = false;
                                    this.focusMode.currentSession = null;
                                    this.pauseTimer();
                                    this.loadFocusData(); // Âà∑Êñ∞Êï∞ÊçÆ
                                    this.$message.success('‰∏ìÊ≥®‰ºöËØùÂ∑≤ÁªìÊùü');
                                }
                            })
                            .catch(error => {
                                console.error('ÁªìÊùü‰ºöËØùÂ§±Ë¥•:', error);
                                this.$message.error('ÁªìÊùü‰ºöËØùÂ§±Ë¥•');
                            });
                    },
                    formatTime(seconds) {
                        // Á°Æ‰øùsecondsÊòØ‰∏Ä‰∏™ÊúâÊïàÁöÑÊï∞Â≠ó
                        if (isNaN(seconds) || seconds < 0) {
                            seconds = 0;
                        }
                        const minutes = Math.floor(seconds / 60);
                        const remainingSeconds = seconds % 60;
                        return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
                    },
                    formatDuration(minutes) {
                        // Ê†ºÂºèÂåñÊó∂ÈïøÊòæÁ§∫ÔºåÂ¶Ç "1h 30m" Êàñ "25m"
                        if (isNaN(minutes) || minutes < 0) {
                            minutes = 0;
                        }
                        const hours = Math.floor(minutes / 60);
                        const remainingMinutes = minutes % 60;
                        
                        if (hours > 0) {
                            return `${hours}h ${remainingMinutes}m`;
                        } else {
                            return `${remainingMinutes}m`;
                        }
                    },
                    showFocusSettings() {
                        this.dialogType = 'focusSettings';
                        this.dialogTitle = '‰∏ìÊ≥®ËÆæÁΩÆ';
                        this.dialogVisible = true;
                    },
                    updateFocusSettings() {
                        axios.post('/focus/settings/update/', this.focusMode.settings)
                            .then(response => {
                                if (response.data.success) {
                                    this.$message.success('ËÆæÁΩÆÂ∑≤‰øùÂ≠ò');
                                    this.dialogVisible = false;
                                }
                            })
                            .catch(error => {
                                console.error('Êõ¥Êñ∞ËÆæÁΩÆÂ§±Ë¥•:', error);
                                this.$message.error('‰øùÂ≠òËÆæÁΩÆÂ§±Ë¥•');
                            });
                    },
                    playNotificationSound() {
                        // ÁÆÄÂçïÁöÑÂ£∞Èü≥ÊèêÈÜíÂÆûÁé∞
                        try {
                            const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvGIcBjuX2/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvGIcBjuX2/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvGIcBjuX2/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvGIcBjuX2/LNdBGdgLgVIkA=');
                            audio.play();
                        } catch (error) {
                            console.log('Êí≠ÊîæÊèêÈÜíÈü≥Â§±Ë¥•:', error);
                        }
                    },
                    showAllHistory() {
                        this.dialogType = 'focusHistory';
                        this.dialogTitle = '‰∏ìÊ≥®ÂéÜÂè≤ËÆ∞ÂΩï';
                        this.dialogVisible = true;
                        // Âä†ËΩΩÊõ¥Â§öÂéÜÂè≤ËÆ∞ÂΩï
                        this.loadAllFocusHistory();
                    },
                    loadAllFocusHistory() {
                        axios.get('/focus/history/?limit=100')
                            .then(response => {
                                if (response.data.success) {
                                    this.focusHistory = response.data.sessions;
                                }
                            })
                            .catch(error => {
                                console.error('Ëé∑ÂèñÂÆåÊï¥ÂéÜÂè≤Â§±Ë¥•:', error);
                                this.$message.error('Ëé∑ÂèñÂéÜÂè≤ËÆ∞ÂΩïÂ§±Ë¥•');
                            });
                    },
                    fetchTasks() {
                        this.loading = true;
                        axios.get('/checkin/checkins/')
                            .then(response => {
                                this.checkins = response.data;
                                this.loading = false;
                            })
                            .catch(error => {
                                console.error('Ëé∑Âèñ‰ªªÂä°Â§±Ë¥•:', error);
                                this.loading = false;
                                this.$message.error('Ëé∑Âèñ‰ªªÂä°Â§±Ë¥•ÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï');
                            });
                    },
                    createTask() {
                        if (!this.newTask.title) {
                            this.$message.error('‰ªªÂä°ÂêçÁß∞‰∏çËÉΩ‰∏∫Á©∫');
                            return;
                        }
                        
                        this.loading = true;
                        axios.post('/checkin/checkins/create/', this.newTask)
                            .then(response => {
                                this.dialogVisible = false;
                                this.checkins.unshift(response.data.checkin);
                                this.$message.success('‰ªªÂä°ÂàõÂª∫ÊàêÂäü');
                                
                                // ÈáçÁΩÆË°®Âçï
                                this.newTask = {
                                    title: '',
                                    time: '',
                                    description: ''
                                };
                                
                                this.loading = false;
                            })
                            .catch(error => {
                                console.error('ÂàõÂª∫‰ªªÂä°Â§±Ë¥•:', error);
                                this.loading = false;
                                this.$message.error('ÂàõÂª∫‰ªªÂä°Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
                            });
                    },
                    deleteCheckin(checkin) {
                        this.$confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ê≠§‰ªªÂä°Âêó?', 'ÊèêÁ§∫', {
                            confirmButtonText: 'Á°ÆÂÆö',
                            cancelButtonText: 'ÂèñÊ∂à',
                            type: 'warning'
                        }).then(() => {
                            this.loading = true;
                            axios.delete(`/checkin/checkins/${checkin.id}/delete/`)
                                .then(response => {
                                    const index = this.checkins.findIndex(c => c.id === checkin.id);
                                    if (index !== -1) {
                                        this.checkins.splice(index, 1);
                                    }
                                    this.$message.success('‰ªªÂä°Â∑≤Âà†Èô§');
                                    this.loading = false;
                                })
                                .catch(error => {
                                    console.error('Âà†Èô§‰ªªÂä°Â§±Ë¥•:', error);
                                    this.loading = false;
                                    this.$message.error('Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
                                });
                        }).catch(() => {
                            // ÂèñÊ∂àÂà†Èô§
                        });
                    },
                    loadUserData() {
                        this.loading = true;
                        Promise.all([
                            axios.get('/accounts/profile/'),
                            axios.get('/checkin/checkins/'),
                            axios.get('/checkin/community/')
                        ])
                        .then(([ profileResponse, checkinsResponse, communityResponse]) => {
                        
                            this.userInfo = profileResponse.data.data;
                            this.checkins = checkinsResponse.data;
                            this.communityCheckins = communityResponse.data;
                            
                            setTimeout(() => {
                                this.loading = false;
                            }, 200); // Ê∑ªÂä†Áü≠ÊöÇÂª∂ËøüÔºåÁ°Æ‰øùÂä®ÁîªÂπ≥Êªë
                        })
                        .catch(error => {
                            console.error('Âä†ËΩΩÁî®Êà∑Êï∞ÊçÆÂ§±Ë¥•:', error);
                            this.loading = false;
                            
                            if (error.response && error.response.status === 401) {
                                // Êú™ÁôªÂΩïÔºåÈáçÂÆöÂêëÂà∞ÁôªÂΩïÈ°µ
                                this.isLoggedIn = false;
                            } else {
                                this.$message.error('Âä†ËΩΩÁî®Êà∑Êï∞ÊçÆÂ§±Ë¥•ÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï');
                            }
                        });
                    },
                    refreshCommunity() {
                        this.loading = true;
                        axios.get('/checkin/community/')
                            .then(response => {
                                this.communityCheckins = response.data;
                                setTimeout(() => {
                                    this.loading = false;
                                }, 200); // Ê∑ªÂä†Áü≠ÊöÇÂª∂ËøüÔºåÁ°Æ‰øùÂä®ÁîªÂπ≥Êªë
                                this.$message.success('Â∑≤Âà∑Êñ∞ÊâìÂç°Âä®ÊÄÅ');
                            })
                            .catch(error => {
                                console.error('Âà∑Êñ∞ÊâìÂç°Âä®ÊÄÅÂ§±Ë¥•:', error);
                                this.loading = false;
                                this.$message.error('Âà∑Êñ∞Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
                            });
                    },
                    sendOldEmailCode() {
                        if (!this.userInfo.email) {
                            this.$message.error('ÂéüÈÇÆÁÆ±‰∏∫Á©∫ÔºåÊó†Ê≥ïÂèëÈÄÅÈ™åËØÅÁ†Å');
                            return;
                        }
                        
                        axios.post('/accounts/send-verification-code/', {
                            email: this.userInfo.email
                        })
                        .then(response => {
                            this.$message.success('È™åËØÅÁ†ÅÂ∑≤ÂèëÈÄÅÂà∞ÂéüÈÇÆÁÆ±');
                            this.oldCodeSending = true;
                            this.oldCodeTimer = 60;
                            
                            // ÂÄíËÆ°Êó∂
                            const timer = setInterval(() => {
                                this.oldCodeTimer -= 1;
                                if (this.oldCodeTimer <= 0) {
                                    clearInterval(timer);
                                    this.oldCodeSending = false;
                                }
                            }, 1000);
                        })
                        .catch(error => {
                            this.$message.error(error.response?.data?.error || 'ÂèëÈÄÅÈ™åËØÅÁ†ÅÂ§±Ë¥•');
                        });
                    },
                    sendNewEmailCode() {
                        if (!this.emailForm.newEmail) {
                            this.$message.error('Êñ∞ÈÇÆÁÆ±‰∏çËÉΩ‰∏∫Á©∫');
                            return;
                        }
                        
                        const emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
                        if (!emailRegex.test(this.emailForm.newEmail)) {
                            this.$message.error('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÈÇÆÁÆ±Âú∞ÂùÄ');
                            return;
                        }
                        
                        axios.post('/accounts/send-verification-code/', {
                            email: this.emailForm.newEmail
                        })
                        .then(response => {
                            this.$message.success('È™åËØÅÁ†ÅÂ∑≤ÂèëÈÄÅÂà∞Êñ∞ÈÇÆÁÆ±');
                            this.newCodeSending = true;
                            this.newCodeTimer = 60;
                            
                            // ÂÄíËÆ°Êó∂
                            const timer = setInterval(() => {
                                this.newCodeTimer -= 1;
                                if (this.newCodeTimer <= 0) {
                                    clearInterval(timer);
                                    this.newCodeSending = false;
                                }
                            }, 1000);
                        })
                        .catch(error => {
                            this.$message.error(error.response?.data?.error || 'ÂèëÈÄÅÈ™åËØÅÁ†ÅÂ§±Ë¥•');
                        });
                    },
                    updateEmail() {
                        // È™åËØÅË°®Âçï
                        if (!this.emailForm.oldCode) {
                            this.$message.error('ËØ∑ËæìÂÖ•ÂéüÈÇÆÁÆ±È™åËØÅÁ†Å');
                            return;
                        }
                        
                        if (!this.emailForm.newEmail) {
                            this.$message.error('ËØ∑ËæìÂÖ•Êñ∞ÈÇÆÁÆ±');
                            return;
                        }
                        
                        if (!this.emailForm.newCode) {
                            this.$message.error('ËØ∑ËæìÂÖ•Êñ∞ÈÇÆÁÆ±È™åËØÅÁ†Å');
                            return;
                        }
                        
                        const emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
                        if (!emailRegex.test(this.emailForm.newEmail)) {
                            this.$message.error('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÈÇÆÁÆ±Âú∞ÂùÄ');
                            return;
                        }
                        
                        this.loading = true;
                        
                        axios.post('/accounts/update-email/', {
                            old_email: this.userInfo.email,
                            old_code: this.emailForm.oldCode,
                            new_email: this.emailForm.newEmail,
                            new_code: this.emailForm.newCode
                        })
                        .then(response => {
                            this.loading = false;
                            this.dialogVisible = false;
                            
                            // Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØ
                            this.userInfo = response.data.user;
                            
                            // Êõ¥Êñ∞Êú¨Âú∞Â≠òÂÇ®
                            localStorage.setItem('user', JSON.stringify(this.userInfo));
                            
                            this.$message.success('ÈÇÆÁÆ±Êõ¥Êñ∞ÊàêÂäü');
                            
                            // ÈáçÁΩÆË°®Âçï
                            this.emailForm = {
                                oldCode: '',
                                newEmail: '',
                                newCode: ''
                            };
                        })
                        .catch(error => {
                            this.loading = false;
                            this.$message.error(error.response?.data?.error || 'Êõ¥Êñ∞ÈÇÆÁÆ±Â§±Ë¥•');
                        });
                    },
                    viewPostDetail(post) {
                        // Ë∑≥ËΩ¨Âà∞Â∏ñÂ≠êËØ¶ÊÉÖÈ°µ
                        window.location.href = `/post_${post.id}.html`;
                    },
                    createPost() {
                        if (!this.newPost.title || !this.newPost.content) {
                            this.$message.error('Â∏ñÂ≠êÊ†áÈ¢òÂíåÂÜÖÂÆπ‰∏çËÉΩ‰∏∫Á©∫');
                            return;
                        }
                        
                        // Á°Æ‰øùÈÄâÊã©‰∫ÜÂ≠¶Ê†°
                        if (!this.selectedSchool || !this.selectedSchool.id) {
                            this.$message.error('ËØ∑ÂÖàÈÄâÊã©‰∏Ä‰∏™Â≠¶Ê†°');
                            return;
                        }
                        
                        // Ê∑ªÂä†Â≠¶Ê†°IDÂà∞ËØ∑Ê±ÇÊï∞ÊçÆ
                        const postData = {
                            ...this.newPost,
                            school_id: this.selectedSchool.id
                        };
                        
                        this.loading = true;
                        axios.post('/forum/posts/create/', postData)
                            .then(response => {
                                this.dialogVisible = false;
                                
                                // Ëé∑ÂèñÂàõÂª∫ÁöÑÂ∏ñÂ≠ê
                                const newPost = response.data.post || response.data;
                                
                                // Â∞ÜÊñ∞Â∏ñÂ≠êÊ∑ªÂä†Âà∞Áî®Êà∑Â∏ñÂ≠êÂàóË°®
                                this.userPosts.unshift(newPost);
                                
                                this.$message.success('Â∏ñÂ≠êÂèëÂ∏ÉÊàêÂäüÔºåÁ≠âÂæÖÁÆ°ÁêÜÂëòÂÆ°Ê†∏');
                                
                                // ÈáçÁΩÆË°®Âçï
                                this.newPost = {
                                    title: '',
                                    content: ''
                                };
                                
                                this.loading = false;
                            })
                            .catch(error => {
                                console.error('ÂèëÂ∏ÉÂ∏ñÂ≠êÂ§±Ë¥•:', error);
                                this.loading = false;
                                this.$message.error('ÂèëÂ∏ÉÂ∏ñÂ≠êÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
                            });
                    },
                    createPostDetailPage(post) {
                        // ÂèëÈÄÅËØ∑Ê±ÇÂàõÂª∫Â∏ñÂ≠êËØ¶ÊÉÖÈ°µÈù¢
                        axios.post('/forum/posts/generate-html/', { post_id: post.id })
                            .then(response => {
                                console.log('Â∏ñÂ≠êËØ¶ÊÉÖÈ°µÈù¢Â∑≤ÁîüÊàê');
                            })
                            .catch(error => {
                                console.error('ÁîüÊàêÂ∏ñÂ≠êËØ¶ÊÉÖÈ°µÈù¢Â§±Ë¥•:', error);
                            });
                    },
                    getStatusType(status) {
                        // Ê†πÊçÆÂ∏ñÂ≠êÁä∂ÊÄÅËøîÂõûÁõ∏Â∫îÁöÑÊ†áÁ≠æÁ±ªÂûã
                        switch (status) {
                            case 'pending':
                                return 'info';
                            case 'approved':
                                return 'success';
                            case 'rejected':
                                return 'danger';
                            default:
                                return 'info';
                        }
                    },
                    goToAdminPage() {
                        // Ë∑≥ËΩ¨Âà∞ÁÆ°ÁêÜÂëòÈ°µÈù¢
                        window.location.href = '/admin_center/admin/';
                    },
                    toggleDarkMode() {
                        // ÂÆûÁé∞Â§úÈó¥Ê®°ÂºèÂàáÊç¢ÈÄªËæë
                        console.log('Â§úÈó¥Ê®°ÂºèÂàáÊç¢', this.settings.darkMode);
                        if (this.settings.darkMode) {
                            document.body.classList.add('dark-mode');
                            this.$message({
                                message: 'Â∑≤ÂºÄÂêØÂ§úÈó¥Ê®°Âºè',
                                type: 'success',
                                duration: 1500,
                                offset: 50
                            });
                        } else {
                            document.body.classList.remove('dark-mode');
                            this.$message({
                                message: 'Â∑≤ÂÖ≥Èó≠Â§úÈó¥Ê®°Âºè',
                                type: 'info',
                                duration: 1500,
                                offset: 50
                            });
                        }
                        
                        // ‰øùÂ≠òËÆæÁΩÆÂà∞Êú¨Âú∞Â≠òÂÇ®
                        this.saveSettings();
                    },
                    saveSettings() {
                        // ‰øùÂ≠òËÆæÁΩÆÂà∞Êú¨Âú∞Â≠òÂÇ®
                        localStorage.setItem('settings', JSON.stringify(this.settings));
                    },
                    loadSettings() {
                        // ‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩËÆæÁΩÆ
                        const savedSettings = localStorage.getItem('settings');
                        if (savedSettings) {
                            try {
                                const parsedSettings = JSON.parse(savedSettings);
                                this.settings = { ...this.settings, ...parsedSettings };
                                
                                // Â∫îÁî®Â§úÈó¥Ê®°ÂºèËÆæÁΩÆ
                                if (this.settings.darkMode) {
                                    document.body.classList.add('dark-mode');
                                } else {
                                    document.body.classList.remove('dark-mode');
                                }
                            } catch (e) {
                                console.error('Ëß£ÊûêËÆæÁΩÆÂ§±Ë¥•:', e);
                            }
                        }
                    },
                    fetchForumData() {
                        if (!this.selectedSchool.id) return;
                        
                        this.loading = true;
                        Promise.all([
                            axios.get(`/forum/posts/?school_id=${this.selectedSchool.id}`),
                            axios.get('/forum/posts/user/') // Ëé∑ÂèñÁî®Êà∑Ëá™Â∑±ÁöÑÂ∏ñÂ≠ê
                        ])
                        .then(([postsResponse, userPostsResponse]) => {
                            this.posts = postsResponse.data;
                            this.userPosts = userPostsResponse.data;
                            setTimeout(() => {
                                this.loading = false;
                            }, 200); // Ê∑ªÂä†Áü≠ÊöÇÂª∂ËøüÔºåÁ°Æ‰øùÂä®ÁîªÂπ≥Êªë
                        })
                        .catch(error => {
                            console.error('Ëé∑ÂèñËÆ∫ÂùõÊï∞ÊçÆÂ§±Ë¥•:', error);
                            this.loading = false;
                            this.$message.error('Ëé∑ÂèñËÆ∫ÂùõÊï∞ÊçÆÂ§±Ë¥•ÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï');
                        });
                    },
                    enterChatRoom() {
                        // Ê†πÊçÆÈÄâÊã©ÁöÑÂ≠¶Ê†°ËøõÂÖ•Áõ∏Â∫îÁöÑËÅäÂ§©ÂÆ§
                        if (!this.selectedSchool || !this.selectedSchool.id) {
                            this.$message.error('ËØ∑ÂÖàÈÄâÊã©‰∏Ä‰∏™Â≠¶Ê†°');
                            return;
                        }
                        
                        // Ë∑≥ËΩ¨Âà∞ÂØπÂ∫îÂ≠¶Ê†°ÁöÑËÅäÂ§©ÂÆ§
                        window.location.href = `/chat/room/${this.selectedSchool.id}/`;
                    }
                },
                beforeDestroy() {
                    // Ê∏ÖÁêÜËÆ°Êó∂Âô®
                    if (this.timerInterval) {
                        clearInterval(this.timerInterval);
                        this.timerInterval = null;
                    }
                },
                mounted() {
                    console.log("VueÂÆû‰æãÂ∑≤ÊåÇËΩΩ");
                    // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ
                    this.checkLoginStatus();
                    
                    // Âä†ËΩΩÁî®Êà∑ËÆæÁΩÆ
                    this.loadSettings();
                    
                    // Âä†ËΩΩÁî®Êà∑Êï∞ÊçÆ
                    this.loading = true;
                    this.loadUserData();
                    
                    // Âä†ËΩΩ‰∏ìÊ≥®Ê®°ÂºèÊï∞ÊçÆ
                    if (this.isLoggedIn) {
                        this.loadFocusData();
                    }
                    
                    // Ëé∑ÂèñÂ≠¶Ê†°ÂàóË°®
                    this.fetchSchools();
                    
                    // ÈöêËóèÈùôÊÄÅÂÜÖÂÆπ
                    let staticContent = document.getElementById('static-content');
                    if (staticContent) {
                        staticContent.style.display = 'none';
                    }
                    
                    // Ê†áËÆ∞ÂàùÂßãÂåñÂÆåÊàê
                    this.initialized = true;
                }
            });
        });
        
        // Á´ãÂç≥Á°Æ‰øùappÊòæÁ§∫
        window.onload = function() {
            var appElement = document.getElementById('app');
            if (appElement) {
                // ‰∏çÂú®ËøôÈáåËÆæÁΩÆdisplay:blockÔºåËÄåÊòØ‰æùËµñv-cloakÊåá‰ª§ÂíåVueÂàùÂßãÂåñÂêéËá™Âä®ÊòæÁ§∫
            }
            
            setTimeout(function() {
                var staticContent = document.getElementById('static-content');
                if (staticContent) {
                    staticContent.style.display = 'none';
                }
            }, 500);
        };
    </script>
</body>
</html> 